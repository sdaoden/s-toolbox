S - p o s t g r a y
===================

A postfix RFC 6647 graylisting policy server that aims in being fast
and secure.  Graylisting defers message acceptance a configurable number
of times via a standardized SMTP response (see RFC 5321, access(5)),
which does not prevent message delivery from SMTP M(essage) T(ransfer)
A(gent)s, but can help against simple spam producing programs.
Please see the manual for more.

To build this software simply run "make install".  At the top of the
makefile there are some variables, they can be overwritten from the
command line:

   $ make DESTDIR=.xxx PREFIX=/usr LIBEXEC=sbin \
      VAL_STORE_PATH=/var/lib/postgray \
      install

This will build and install the binary under [.xxx]/usr/sbin.
The default built-in path for database storage and the client/server
communication socket will be /var/lib/postgray, and it should be ensured
that this directory exists and is accessible by the desired user; it
must _not_ be accessible by other users or groups, as user mask and
file modes (umask(2), chmod(2)) are "not handled".

RELEASES
--------

v0.6.0, 2022-03-31:

v0.7.0, 2022-06-07:
  - An iteration that fixes some oddities, and clarifies documentation.
    (The example configuration is also better.)
  - Bug fixes:
    . -v and -p were not reset for reload, thus fixated once set.
    . -b and -B were not command-line-parsed by the server, only in
      --test-mode (driven by client); usage in resource-file ok, too.
  - --test-mode now outputs a normalized resource file.
  - New --focus-sender approach which i like better.
      [I personally now use --focus-sender mode with --count=1,
      --msg-allow=permit and --msg-defer='DEFER 4.2.0 blabla',
      and reject_unverified_sender thereafter.]
  - New --msg-{allow,block}, and --msg-defer for misnamed --defer-msg,
    which is kept for compatibility.

v0.8.0, 2022-09-16:
  - New --startup mode to allow it to be driven as a standalone daemon.
  - INCOMPAT!  The gray DB name did not adapt the makefile's VAL_NAME yet.
  - Client no longer exits after five unsuccessful connection attempts.
    Instead try as long as postfix is willing to let it.
  - "Fixes a miss": if on server startup the socket yet existed (no
    proper shutdown on last run), startup failed and the missing policy
    server would cause postfix to refuse acting.
    Whereas "rm -f PG-SOCKET" in a postfix-startup-script avoids this,
    it was never announced to be necessary, so henceforth automatize this.
  - Robustness against MFILE,NFILE,NOBUF,NOMEM in file/socket open paths.
  - Fixes some oddities, and clarifies documentation.

v0.8.1, 202?-??-??:
  - Source code style change, saves ~12KB.

NOTE
----

The test script *may* fail on (very, very, very) slow systems: in order
not to take too long it uses very narrow time limits, and on slow
systems errors can happen (in particular 5.9).

THANKS
------

People contributed by reporting problems, suggesting various
improvements, whether directly or indirectly, or submitting actual code.
Here is a list of those people.  I hope the list is complete and free of
errors.

Joachim Lindenberg      postfix-users at lindenberg dot one
Matus UHLAR - fantomas  uhlar at fantomas dot sk

Thank you!

P.S.
----

For now the build system is rudimentary.  Either it works, then
the software should, too, or it will not.  This will surely change in
the future.

# s-ts-mode
